<!DOCTYPE html>
<meta charset="utf-8">
<style>

.graticule {
  fill: none;
  stroke: #777;
}

.boundary {
  fill: #ccc;
  fill-opacity: .8;
  stroke: #000;
}

</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/d3.geo.projection.v0.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script>

var width = 960,
    height = 960;

// var projection = d3.geo.satellite()
//     .distance(1.1) //??
//     .scale(1000) //zoom?
    // .rotate([-110.00, -36.50, 0]) //yaw, pitch, roll
//     .center([-2, 5])  //Center of the map relative to svg container??
//     .tilt(0)
//     .clipAngle(Math.acos(1 / 1.1) * 180 / Math.PI - 1e-6)
//     .precision(0.1);

var projection = d3.geo.satellite()
    .distance(1.1)
    .scale(1500)    
    // .rotate([66.00, -44.50, 0])
    // .rotate([76.00, -34.50, 32.12])
    .center([-2, 5])
    .tilt(0)
    .clipAngle(Math.acos(1 / 1.1) * 180 / Math.PI - 1e-6)
    .precision(.1);    

projection.rotate([-117.00, -36.50,0]) //yaw, pitch, roll    


var graticule = d3.geo.graticule()
    .extent([[-93, 0.49], [150.61, 90]])
    // .extent([-36,-110.50],[-47,57])
    .step([1, 1]);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

d3.json("js/us-land.json", function(error, us) {
  svg.append("path")
      .datum(topojson.feature(us, us.objects.land))
      .attr("class", "boundary")
      .attr("d", path);
});

d3.json("js/china3.json", function(error, china) {
  if (error) return console.error(error);
  console.log(china);

// d3.select("body").selectAll(".place-label").data([]).exit().remove();
d3.select("body").selectAll("path").data([]).exit().remove();

svg.append("path")
    .datum(graticule)
    .attr("class", "graticule")
    .attr("d", path);

svg.append("path")
      .datum(topojson.feature(china, china.objects.us_10m_china))
      .attr("class", "boundary")
      .attr("d", path);

svg.append("path")
    .datum(topojson.feature(china, china.objects.china_cities_places3))
    .attr("d", path)
    .attr("class", "place");

svg.selectAll(".place-label")
    .data(topojson.feature(china, china.objects.china_cities_places3).features)
  .enter().append("text")
    .attr("class", "place-label")
    .attr("transform", function(d) { return "translate(" + projection(d.geometry.coordinates) + ")"; })
    .attr("dy", ".35em")
    .text(function(d) { return d.properties.name; });


d3.select(self.frameElement).style("height", height + "px");

window.onload= start();

var threshold = 200;
//create the mechanism to run several times, then stop
var timesRun = 0;

//tells you where you are in the sequence, how many spaces the bars are ofput by.
var j = 0; 

function start() {
	var loop = setInterval(function () {
        loopfunction();
        
        timesRun += 1;
        j += 1;
            if(timesRun === threshold+1){
                clearInterval(loop);
                timesRun = 0;	                    
                j = 0; 						//reset initial beginning sequence number to 0 when it reaches threshold
                start();        				            
            }
    }, 5);
};

//what to do each time.
function loopfunction() { console.log
console.log("hello")


// console.log(projection)





	}
});
</script>
